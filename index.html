<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>easyresults | Cloud-Based School Result Management System</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#020617">
    <link rel="apple-touch-icon" href="logo.png">
    
    <meta name="description" content="Digitize your institution with easyresults. A secure, automated student portal and academic result management system designed for modern schools and educators.">
    <meta name="keywords" content="school management software, result management system, student portal, automated report cards, digital academic records, easyresults">
    <meta name="author" content="easyresults Systems">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="security.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="config.js"></script>
    <script src="utils.js"></script>

    <style>
        /* --- DESIGN SYSTEM --- */
        body { font-family: 'Plus Jakarta Sans', sans-serif; scroll-behavior: smooth; background-color: #020617; color: #f8fafc; }
        
        /* Gradients & Text */
        .gradient-text { 
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); 
            background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.6s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        
        /* Glassmorphism */
        .glass-nav { 
            background: rgba(2, 6, 23, 0.8); backdrop-filter: blur(12px); 
            border-bottom: 1px solid rgba(255,255,255,0.05); 
        }
        .feature-card {
            background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }
        .feature-card:hover { transform: translateY(-5px); border-color: #3b82f6; box-shadow: 0 10px 30px -10px rgba(59, 130, 246, 0.2); }

        /* Buttons */
        .btn-glow {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); transition: all 0.2s;
        }
        .btn-glow:hover { box-shadow: 0 0 30px rgba(59, 130, 246, 0.5); transform: scale(1.02); }

        select option { background-color: #0f172a; color: #fff; }
    </style>
</head>
<body class="overflow-x-hidden">

    <div id="global-loader" class="fixed inset-0 flex flex-col items-center justify-center text-white z-[9999] hidden bg-slate-950/80 backdrop-blur-sm">
        <div class="w-12 h-12 border-4 border-white/10 border-t-blue-500 rounded-full animate-spin mb-4"></div>
        <p class="text-sm font-bold tracking-widest animate-pulse font-mono">PROCESSING...</p>
    </div>
    <div id="toast-container" class="fixed top-6 right-6 z-[100] flex flex-col gap-3 pointer-events-none"></div>

    <div class="fixed inset-0 pointer-events-none -z-10">
        <div class="absolute top-0 left-1/4 w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-purple-600/10 rounded-full blur-[120px]"></div>
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-[0.03]"></div>
    </div>

    <nav class="fixed top-0 w-full z-50 glass-nav">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3 font-bold text-xl tracking-tight">
                <div id="nav-logo-container" class="w-10 h-10 bg-white/5 border border-white/10 rounded-xl flex items-center justify-center text-white shadow-lg overflow-hidden shrink-0">
                    <img id="nav-img" src="logo.png" class="w-full h-full object-cover" alt="Brand Logo">
                </div>
                <span id="cms-brand-name" class="text-white">easyresults</span>
            </div>
            
            <div class="hidden md:flex items-center gap-8 text-sm font-medium text-slate-400">
                <a href="#features" class="hover:text-white transition">Features</a>
                <a href="#about" class="hover:text-white transition">Why Us</a>
                <a href="#register" class="hover:text-white transition">Get Started</a>
                <a href="guide.html" class="flex items-center gap-2 px-4 py-2 bg-blue-500/10 text-blue-400 rounded-lg hover:bg-blue-500/20 hover:text-blue-300 transition font-bold border border-blue-500/20 shadow-lg shadow-blue-500/10">
                    <i class="fas fa-book-open"></i> User Guide
                </a>
            </div>
        </div>
    </nav>

    <header class="min-h-screen flex flex-col items-center justify-center text-center px-6 pt-20 relative">
        <div class="fade-in" style="animation-delay: 0.1s">
            <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-emerald-500/20 bg-emerald-500/10 text-emerald-400 text-xs font-bold uppercase tracking-widest mb-8 shadow-lg shadow-emerald-500/10">
                <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                Secure & Verified Platform
            </div>
        </div>
        
        <h1 id="hero-title" class="text-5xl md:text-7xl font-extrabold mb-6 tracking-tight leading-tight max-w-4xl mx-auto fade-in" style="animation-delay: 0.2s">
            The Intelligent Way to <br>
            <span class="gradient-text">Manage Academic Results.</span>
        </h1>
        
        <p id="hero-sub" class="text-lg text-slate-400 max-w-2xl mx-auto mb-10 leading-relaxed fade-in" style="animation-delay: 0.3s">
            Transform your school's grading process. easyresults provides a fully branded, secure, and automated student portal for modern educational institutions.
        </p>
        
        <div class="flex flex-col sm:flex-row gap-4 fade-in" style="animation-delay: 0.4s">
            <a href="#register" id="hero-btn" class="px-8 py-4 btn-glow text-white font-bold rounded-xl flex items-center justify-center gap-2">
                Register Institution <i class="fas fa-arrow-right"></i>
            </a>
            <a id="wa-link" href="#" target="_blank" class="px-8 py-4 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl border border-slate-700 transition flex items-center justify-center gap-2">
                <i class="fab fa-whatsapp text-green-400 text-lg"></i> Contact Sales
            </a>
        </div>

        <div class="mt-12 w-full max-w-md mx-auto fade-in" style="animation-delay: 0.5s">
            <div class="p-1.5 rounded-2xl bg-slate-900/80 border border-slate-700 flex items-center shadow-2xl backdrop-blur-md">
                <div class="px-4 text-slate-500"><i class="fas fa-search" aria-hidden="true"></i></div>
                <input type="text" id="quick-portal-id" placeholder="Enter Institution Account ID" class="bg-transparent border-none text-white w-full outline-none placeholder-slate-500 text-sm" onkeypress="if(event.key === 'Enter') goToPortal()" aria-label="Institution Account ID">
                <button onclick="goToPortal()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2.5 rounded-xl font-bold transition text-sm flex items-center gap-2 shadow-lg shrink-0">
                    Find Portal
                </button>
            </div>
            <p class="text-[10px] text-slate-500 mt-3 uppercase tracking-widest font-bold">Students & Staff: Enter your School ID to log in</p>
        </div>

        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce text-slate-600 hidden md:block">
            <i class="fas fa-chevron-down" aria-hidden="true"></i>
        </div>
    </header>

    <section id="features" class="py-24 relative z-10">
        <div class="max-w-6xl mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-bold text-white mb-4">Powerful Features for Modern Schools</h2>
                <p class="text-slate-400">Everything you need to digitize academic records and streamline grading.</p>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="feature-card p-8 rounded-2xl">
                    <div class="w-14 h-14 bg-blue-500/10 text-blue-400 rounded-xl flex items-center justify-center text-2xl mb-6">
                        <i class="fas fa-globe" aria-hidden="true"></i>
                    </div>
                    <h3 id="f1-t" class="text-xl font-bold text-white mb-3">Custom Student Portal</h3>
                    <p id="f1-d" class="text-slate-400 text-sm leading-relaxed">Launch a dedicated, white-labeled web portal fully branded with your institution's colors for a premium parent-student experience.</p>
                </div>
                <div class="feature-card p-8 rounded-2xl">
                    <div class="w-14 h-14 bg-purple-500/10 text-purple-400 rounded-xl flex items-center justify-center text-2xl mb-6">
                        <i class="fas fa-bolt" aria-hidden="true"></i>
                    </div>
                    <h3 id="f2-t" class="text-xl font-bold text-white mb-3">Automated Marksheets</h3>
                    <p id="f2-d" class="text-slate-400 text-sm leading-relaxed">Upload scores easily via Excel or manual entry. The system instantly generates professional, mathematically accurate, downloadable PDF report cards.</p>
                </div>
                <div class="feature-card p-8 rounded-2xl border-l-4 border-l-emerald-500">
                    <div class="w-14 h-14 bg-emerald-500/10 text-emerald-400 rounded-xl flex items-center justify-center text-2xl mb-6">
                        <i class="fas fa-shield-check" aria-hidden="true"></i>
                    </div>
                    <h3 id="f3-t" class="text-xl font-bold text-white mb-3">Tamper-Proof Records</h3>
                    <p id="f3-d" class="text-slate-400 text-sm leading-relaxed">Bank-grade security protects your admin panels. Strict owner-verification locks official logos and signatures to prevent unauthorized editing.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="about" class="py-24 bg-slate-900/50 border-y border-slate-800">
        <div class="max-w-5xl mx-auto px-6 grid md:grid-cols-2 gap-16 items-center">
            <div>
                <h2 id="ab-head" class="text-3xl font-bold text-white mb-6">Built to Empower Education</h2>
                <p id="ab-text" class="text-slate-400 mb-8 leading-loose">
                    easyresults simplifies the complex task of academic administration. From securely managing student directories to publishing real-time exam results, our cloud-based platform provides educators and administrators the tools they need to succeed in the digital age.
                </p>
                
                <div class="grid grid-cols-2 gap-6">
                    <div class="p-5 bg-slate-800 rounded-2xl border border-slate-700">
                        <div id="stat-1-val" class="text-4xl font-black text-white mb-1">0+</div>
                        <div id="stat-1-lbl" class="text-xs font-bold text-slate-500 uppercase tracking-wider">Partner Schools</div>
                    </div>
                    <div class="p-5 bg-slate-800 rounded-2xl border border-slate-700">
                        <div id="stat-2-val" class="text-4xl font-black text-white mb-1">0+</div>
                        <div id="stat-2-lbl" class="text-xs font-bold text-slate-500 uppercase tracking-wider">Students Managed</div>
                    </div>
                </div>
            </div>
            
            <div class="relative hidden md:block">
                <div class="absolute -inset-4 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full blur-3xl opacity-20"></div>
                <div class="relative bg-slate-800 p-8 rounded-3xl border border-slate-700 shadow-2xl">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-12 h-12 rounded-full bg-slate-700 animate-pulse"></div>
                        <div class="h-4 bg-slate-700 rounded w-1/2"></div>
                    </div>
                    <div class="space-y-3">
                        <div class="h-4 bg-slate-700 rounded w-full"></div>
                        <div class="h-4 bg-slate-700 rounded w-5/6"></div>
                        <div class="h-4 bg-slate-700 rounded w-4/6"></div>
                    </div>
                    <div class="mt-8 flex gap-4">
                        <div class="h-10 bg-blue-600/20 rounded-lg w-1/3"></div>
                        <div class="h-10 bg-slate-700 rounded-lg w-1/3"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="register" class="py-24 relative z-10 border-t border-slate-800 bg-[#020617]">
        <div class="max-w-4xl mx-auto px-6">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-white mb-4">Register Your Institution Today</h2>
                <p class="text-slate-400">Create your administrator account below. Our team will verify and activate your secure cloud portal immediately.</p>
            </div>
            
            <div class="glass-nav p-8 md:p-10 rounded-3xl border border-slate-700 shadow-2xl max-w-3xl mx-auto relative overflow-hidden">
                <div class="absolute top-0 right-0 w-64 h-64 bg-green-500/10 rounded-full blur-[80px] pointer-events-none"></div>
                
                <form id="reg-form" class="space-y-6 relative z-10" onsubmit="submitRegistration(event)">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Institution Name</label>
                            <input id="req-school" class="w-full bg-slate-800/50 border border-slate-700 focus:border-blue-500 rounded-xl px-4 py-3 text-white mt-2 outline-none transition" required placeholder="e.g. Springfield Academy">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Contact Person</label>
                            <input id="req-name" class="w-full bg-slate-800/50 border border-slate-700 focus:border-blue-500 rounded-xl px-4 py-3 text-white mt-2 outline-none transition" required placeholder="Your Full Name">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Admin Email (Login ID)</label>
                            <input type="email" id="req-email" class="w-full bg-slate-800/50 border border-slate-700 focus:border-blue-500 rounded-xl px-4 py-3 text-white mt-2 outline-none transition" required placeholder="admin@school.com">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Mobile Number</label>
                            <div class="flex mt-2">
                                <select id="req-country-code" class="bg-slate-800/50 border border-slate-700 border-r-0 focus:border-blue-500 rounded-l-xl px-2 py-3 text-white outline-none transition w-[40%] sm:w-[35%] text-xs sm:text-sm cursor-pointer">
                                    <option value="+1">+1 (US/CA)</option>
                                    <option value="+44">+44 (UK)</option>
                                    <option value="+91" selected>+91 (IN)</option>
                                    <option value="+971">+971 (UAE)</option>
                                    <option value="+966">+966 (SA)</option>
                                    <option value="+61">+61 (AU)</option>
                                </select>
                                <input type="tel" id="req-phone" class="w-full bg-slate-800/50 border border-slate-700 focus:border-blue-500 rounded-r-xl px-3 py-3 text-white outline-none transition" required placeholder="Phone Number">
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Admin Password</label>
                            <input type="password" id="req-pass" class="w-full bg-slate-800/50 border border-slate-700 focus:border-blue-500 rounded-xl px-4 py-3 text-white mt-2 outline-none transition" required placeholder="Create a secure password for your portal">
                        </div>
                    </div>
                    
                    <div class="pt-4 space-y-4">
                        <button type="submit" id="btn-register" class="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl transition shadow-lg shadow-green-900/20 flex items-center justify-center gap-3 text-lg">
                            <i class="fab fa-whatsapp text-2xl"></i> Register & Request Approval
                        </button>
                        
                        <div class="flex flex-col sm:flex-row items-center justify-between gap-4 text-xs bg-slate-900/50 p-4 rounded-xl border border-slate-800">
                            <p class="text-slate-400 flex items-center gap-2">
                                <i class="fas fa-lock text-blue-400 text-sm"></i> Password securely encrypted by Google.
                            </p>
                            <a href="guide.html" target="_blank" class="flex items-center gap-2 px-4 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white rounded-lg transition border border-slate-700 font-bold shrink-0">
                                <i class="fas fa-question-circle text-blue-400"></i> Need Help? Read Guide
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <footer class="py-8 text-center text-slate-600 text-sm border-t border-slate-800 bg-slate-950">
        <p>&copy; 2025 <span id="footer-text" class="text-slate-500 font-bold">easyresults Systems</span>. All Rights Reserved.</p>
    </footer>

    <script>
        let globalWhatsappNumber = "";

        window.onload = async function() {
            try {
                const docSnap = await db.collection('site_config').doc('main').get();
                const c = docSnap.exists ? docSnap.data() : {};
                
                const instSnap = await db.collection('institutions').count().get();
                const stuSnap = await db.collection('students').count().get();

                if(c.brandName) {
                    document.title = c.brandName + " | Cloud-Based School Result Management System";
                    document.getElementById('cms-brand-name').innerText = c.brandName;
                }
                
                if(c.brandLogo) {
                    const img = document.getElementById('nav-img');
                    img.src = formatImageUrl(c.brandLogo); 
                }

                if(c.heroTitle) document.getElementById('hero-title').innerHTML = c.heroTitle.replace(/\n/g, "<br>");
                if(c.heroSub) document.getElementById('hero-sub').innerText = c.heroSub;
                if(c.heroBtn) document.getElementById('hero-btn').innerHTML = `${c.heroBtn} <i class="fas fa-arrow-right ml-2"></i>`;
                
                if(c.whatsapp) {
                    globalWhatsappNumber = c.whatsapp;
                    const url = `https://wa.me/${c.whatsapp}`;
                    document.getElementById('wa-link').href = url;
                }

                if(c.f1Title) document.getElementById('f1-t').innerText = c.f1Title;
                if(c.f1Desc) document.getElementById('f1-d').innerText = c.f1Desc;
                if(c.f2Title) document.getElementById('f2-t').innerText = c.f2Title;
                if(c.f2Desc) document.getElementById('f2-d').innerText = c.f2Desc;
                if(c.f3Title) document.getElementById('f3-t').innerText = c.f3Title;
                if(c.f3Desc) document.getElementById('f3-d').innerText = c.f3Desc;

                if(c.aboutHead) document.getElementById('ab-head').innerText = c.aboutHead;
                if(c.aboutText) document.getElementById('ab-text').innerText = c.aboutText;
                if(c.stat1Label) document.getElementById('stat-1-lbl').innerText = c.stat1Label;
                if(c.stat2Label) document.getElementById('stat-2-lbl').innerText = c.stat2Label;
                
                document.getElementById('stat-1-val').innerText = instSnap.data().count + '+'; 
                document.getElementById('stat-2-val').innerText = stuSnap.data().count + '+';

                if(c.footerText) document.getElementById('footer-text').innerText = c.footerText;
                
            } catch(e) {
                console.error("Error connecting to Firebase:", e);
            }
        };

        function goToPortal() {
            const id = document.getElementById('quick-portal-id').value.trim();
            if(id) {
                window.location.href = `home.html?id=${id}`;
            } else {
                showToast("Please enter a valid Institution ID.", "error");
            }
        }

        async function submitRegistration(e) {
            e.preventDefault();
            
            const btn = document.getElementById('btn-register');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Processing...';
            btn.disabled = true;
            
            if(typeof showLoader === "function") showLoader(true);
            
            const school = document.getElementById('req-school').value;
            const name = document.getElementById('req-name').value;
            const email = document.getElementById('req-email').value;
            const countryCode = document.getElementById('req-country-code').value;
            const rawPhone = document.getElementById('req-phone').value;
            const phone = countryCode + " " + rawPhone;
            const pass = document.getElementById('req-pass').value;

            try {
                // PHASE 1 SECURITY: Register user in Google Firebase Auth instead of storing plain password
                const userCred = await auth.createUserWithEmailAndPassword(email, pass);
                const uid = userCred.user.uid;

                // Save public metadata to Firestore using the Secure Auth UID (Notice no 'pass' field!)
                await db.collection('institutions').doc(uid).set({
                    name: school,
                    email: email,
                    contactName: name,
                    contactEmail: email,
                    contactPhone: phone,
                    isActive: false,       
                    hasFullAccess: false,
                    themeColor: '#6366f1', 
                    theme: 'deep_space',   
                    createdAt: new Date().toISOString()
                });

                if (globalWhatsappNumber) {
                    const text = `*New Institution Registration*%0A%0A*School Name:* ${school}%0A*Admin Email:* ${email}%0A*Contact:* ${name} (${phone})%0A%0AHello, I have just registered my institution on easyresults. My designated Account ID is: *${uid}*. Please approve my account to activate the portal.`;
                    const waUrl = `https://wa.me/${globalWhatsappNumber}?text=${text}`;
                    
                    window.open(waUrl, '_blank');
                } else {
                    showToast("Registration successful!");
                }

                if(typeof showLoader === "function") showLoader(false);
                setTimeout(() => {
                    window.location.href = `home.html?id=${uid}`;
                }, 1500);

            } catch(err) {
                console.error("Registration Error:", err);
                if(typeof showLoader === "function") showLoader(false);
                showToast(err.message, "error");
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>